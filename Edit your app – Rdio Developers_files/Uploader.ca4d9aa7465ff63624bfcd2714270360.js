Bujagali.fxns["client/Components/Uploader/Uploader.bg.html"]=function(){return function(ctx,args){var self=this;var done=function(post){var markup=self.markup;if(args&&args._blockProviders){args._blockProviders=null}self.done(post);ctx=null;args=null;self=null;done=function(){};return markup};function emit(more){Array.prototype.splice.apply(self.markup,[self.markup.length,more.length].concat(more))}emit(['<form method="post" action="/api/1/" enctype="multipart/form-data">\n  <input type="hidden" name="method" value="',self.args.apiMethod,'" />\n  <input type="hidden" name="_authorization_key" value="',R.currentUser.get("authorizationKey"),'" />\n  <input class="file" type="file" name="',self.args.name,'"',self.args.accept?' accept="'+self.args.accept+'"':""," />\n</form>\n"]);return done()}}();!function($){R.Component.create("Uploader",{options:{apiMethod:null,success:null,error:null,accept:null,name:"file",content:null},events:{"change input.file":"triggerChange"},initialize:function(){R.Component.prototype.initialize.apply(this,arguments);this.options.success=this.options.success||R.doNothing;if(!_.isFunction(this.options.success)){throw new Error("Uploader success option expected a function.")}this.options.error=this.options.error||R.doNothing;if(!_.isFunction(this.options.error)){throw new Error("Uploader error option expected a function.")}},triggerChange:function(e){this.trigger("change",e)},_insertContentInputs:function(){var self=this;this.$(".api_arg").remove();_.each(R.Utils.value(this.options.content),function(value,field){field=Bujagali.Utils.escape(field);value=Bujagali.Utils.escape(value);$('<input type="hidden" class="api_arg" name="'+field+'" value="'+value+'" />').appendTo(self.$("form"))})},onDestroyed:function(){if(this.$iframe){this.$iframe.remove()}},upload:function(){if(!this.$("input.file").val()){return}this._insertContentInputs();var self=this;var iframeId=_.uniqueId("iframe");var $form=this.$("form");this.$iframe=$("<iframe />").attr("id",iframeId).attr("name",iframeId).hide();$("body").append(this.$iframe);this.$iframe.load(function(){var response=JSON.parse(self.$iframe.contents().find("body").text());if(response.status==="ok"){self.$("input.file").val("");self.options.success(response)}else{self.options.error(response)}self.$iframe.remove()});$form.attr("target",iframeId).submit()}})}(R.$);
//# sourceMappingURL=/media/client/orig/Components/Uploader.ca4d9aa7465ff63624bfcd2714270360.js.map